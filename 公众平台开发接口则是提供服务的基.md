CORS实现跨域
var xhr = new XMLHttpRequest()
xhr.open('GET', 'http://localhost:8888/api/getFriend')
xhr.setRequestHeader('token', 'quanquanbunengshuo')
xhr.withCredentials = true;
xhr.onreadystatechange = function() {
		if(xhr.readyState === 4 && xhr.status === 200) {
				console.log(xhr.responseText)
				console.log(xhr.getAllResponseHeaders())
		}
}
xhr.send()

公众平台开发接口则是提供服务的基础，开发者在公众平台网站中创建公众号、获取接口权限
每个用户针对每个公众号会产生一个安全的OpenID
在申请到认证公众号之前，你可以先通过测试号申请系统，快速申请一个接口测试号，立即开始接口测试开发。 
在开发过程中，可以使用接口调试工具来在线调试某些接口。
开发出现问题时，可以通过接口调用的返回码，以及报警排查指引（在公众平台官网-开发者中心处可以设置接口报警）
公众平台以access_token为接口调用凭据，来调用接口，所有接口的调用需要先获取access_token，access_token在2小时内有效，过期需要重新获取，但1天内获取次数有限，开发者需自行存储，详见获取接口调用凭据（access_token）文档。


2、公众号内网页
1）网页授权获取用户基本信息：通过该接口，可以获取用户的基本信息（获取用户的OpenID是无需用户同意的，获取用户的基本信息则需用户同意）
2）微信JS-SDK：是开发者在网页上通过JavaScript代码使用微信原生功能的工具包，开发者可以使用它在网页上录制和播放微信语音、监听微信分享、上传手机本地图片、拍照等许多能力。


微信公众号-服务号 有所有的接口请求权限
1.用户进入服务号（服务号本身是一个服务器 - java服务）服务端获取access_token
2.当进入h5推荐的链接后前端请求接口获取access_token （如api/config全局配置接口）
3.前端获取access_token后，可请求微信提供的api接口

1.先获取access_token
2.获取用户信息 获取用户基本信息


公众号接口权限说明
基础支持-获取access_token
用户管理-获取用户基本信息
用户管理-网页授权获取用户openid/用户基本信息
微信支付接口
微信JS-SDK-分享接口
微信JS-SDK-微信支付


微信网页开发
微信网页授权
微信JS-SDK说明文档
微信开发者工具


1.1 JSSDK使用步骤

1.1.1 步骤一：绑定域名

1.1.2 步骤二：引入JS文件

1.1.3 步骤三：通过config接口注入权限验证配置

1.1.4 步骤四：通过ready接口处理成功验证

1.1.5 步骤五：通过error接口处理失败验证

1.2 接口调用说明

3 分享接口

14 微信支付
14.1 发起一个微信支付请求


第一步 先去申请一个测试号，在微信公众平台申请一个就可以了
第二步 去弄一个花生壳账号搞一个域名 进行内网穿透
第三步 在测试号的管理系统
      1.网页服务	网页帐号	网页授权获取用户基本信息   ----配置回调域名
			2.授权回调页面域名:
			用户在网页授权页同意授权给公众号后，微信会将授权数据传给一个回调页面，回调页面需在此域名下，以确保安全可靠。
			沙盒号回调地址支持域名和ip，正式公众号回调地址只支持域名。
			
			
			
1）网页授权分为两种：

一种为只获取openid (基本授权 snsapi_base)
一种为获取用户全部信息，仅限账户、昵称以及头像等信息 (高级授权 snsapi_userinfo)
（2）你的公众号必须为认证的订阅号或者认证的服务号或申请官方提供的测试号，否则没有此接口权限。

（3）你要配置好回调域名：即用户点击网址获取用户信息后打开哪个域名。



NATAPP申请域名
nginx代理6188端口
再通过反向代理指向本地web


NATAPP 启动服务  http://jcvcze.natappfree.cc -> 127.0.0.1:80  
建立 nginx web服务 默认端口 80  http://127.0.0.1 
nginx收到80端口的请求后，再把请求转发到webpack的服务(默认是8080端口)。这样就能够实现本地开发，下文会具体介绍。
cd /Users/sunzehao/Downloads/安装包
 ./natapp -authtoken=29408d3a3ff3f8e7
 
 
 重启nginx
 sudo nginx -s reload
 编辑nginx 配置
 vim /usr/local/etc/nginx/nginx.conf
 
 mock服务 
 http://jcvcze.natappfree.cc/api/
 并且nginx 添加监听6188端口的 代理指向  http://localhost:3999 的mock服务
 

网页帐号	网页授权获取用户基本信息  
1.配置域名不能带协议  127.0.0.1:6188  或域名访问 mfb9vc.natappfree.cc  也不能带路径 如 127.0.0.1:6188/index/index
2.不能加参数

第一步：请求CODE
非静默授权
https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxcb11c3655f5fc36f&redirect_uri=http://127.0.0.1:6188&response_type=code&scope=snsapi_userinfo&state=123#wechat_redirect
静默授权
https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxcb11c3655f5fc36f&redirect_uri=http://127.0.0.1:6188&response_type=code&scope=snsapi_base&state=123#wechat_redirect


第二步：通过code换取网页授权access_token
通过code换取的是一个特殊的网页授权access_token,与基础支持中的access_token（该access_token用于调用其他接口）不同
每次使用完access_token 都需要重新授权 重复第一步
https://api.weixin.qq.com/sns/oauth2/access_token?appid=wxcb11c3655f5fc36f&secret=a9b09d953a829b171cbd6bc92a96f950&code=071T4MoS0WZEH624SoqS0ciDoS0T4Mon&grant_type=authorization_code


1.html5 History Api
2.node express 实现网页授权
  1）wx_loginx 路由  获取code 
	2）wx_get_token 路由  根据code获取 网页access_token
	2）wx_get_userinfo 路由  仅限获取用户基本信息
	
	
	=================注意问题=====================
	
1.根据openid生成单个用户token签名(签名用sign生成)

没有redis获取并设置之后调用next下一步
若异常则返回异常信息

将拦截器和wx oauth放在一起或将重复部分封装公共方法。

Pm2管理

日志打印

特殊考虑何时判断token是否失效接口

cookie 丢失问题  cookie必须设置同域名下

REDIRECTURL通过接口返回的路径来控制


[WDS] Disconnected!
mainfest.json配置
"devServer" : {
		"host" : "localhost",
		"disableHostCheck" : true,
		"https" : false,
		"port" : "8000"
},



brew install http://nginx.org/download/nginx-1.2.0.tar.gz


需要优化的内容
1.nginx 静态资源缓存
2.所有的跳转路径都需要经过首页  如何控制 否则所有页面$store初始化数据拿不到